# =============================================================================
# Rabbit Lark Bot — 环境变量配置模板
# 复制为 .env 并填写实际值：cp .env.example .env
# =============================================================================

# =============================================================================
# 数据库（必填）
# =============================================================================
DATABASE_URL=postgres://rabbit:your_secure_password@localhost:5432/rabbit_lark

# Docker Compose 用（自动构建 DATABASE_URL，与上面保持一致）
POSTGRES_USER=rabbit
POSTGRES_PASSWORD=your_secure_password
POSTGRES_DB=rabbit_lark

# 连接池配置（可选，有合理默认值）
# DB_POOL_MAX=10
# DB_IDLE_TIMEOUT=30000
# DB_CONNECT_TIMEOUT=5000
# DB_STATEMENT_TIMEOUT=10000

# =============================================================================
# 飞书应用（必填）
# 在 https://open.feishu.cn/app 创建应用后获取
# =============================================================================
FEISHU_APP_ID=cli_xxx
FEISHU_APP_SECRET=your_app_secret

# 飞书事件加密密钥 — 生产环境必须设置！
# 在飞书开放平台 → 事件与回调 → 加密策略 中生成
# ⚠️  不设置则 webhook 无签名验证，任何人都可以伪造事件
FEISHU_ENCRYPT_KEY=your_encrypt_key

# =============================================================================
# 认证配置（生产环境必填）
# =============================================================================

# JWT 会话密钥 — 用于签发 Web 管理后台 session cookie
# 生成：openssl rand -hex 32
# ⚠️  生产环境必填，不设置则使用随机密钥（重启后所有 session 失效）
JWT_SECRET=your_jwt_secret_here

# 管理后台密码登录（备选方案，飞书 OAuth 优先）
# 设置后可通过密码登录管理后台
ADMIN_PASSWORD=your_admin_password

# 飞书 OAuth 回调地址 — 配置后支持飞书扫码登录
# 需要同时在飞书开放平台 → 安全设置 → 重定向 URL 中添加
FEISHU_OAUTH_REDIRECT_URI=https://your-domain.com/api/auth/feishu/callback

# Web 管理 API 鉴权 Key（向后兼容，新部署可选）
# 新部署使用 JWT session 认证，此 key 仅作为后备
# 生成：openssl rand -hex 32
API_KEY=your_api_key_here

# CORS 配置
CORS_ORIGIN=https://your-domain.com

# =============================================================================
# AI Agent 配置
# =============================================================================

# Agent 接收消息的 webhook 端点
# OpenClaw 运行在宿主机时（Docker 内部访问宿主机）：
AGENT_WEBHOOK_URL=http://host.docker.internal:18789/lark-webhook
# OpenClaw 在外部服务器时：
# AGENT_WEBHOOK_URL=https://your-openclaw-server.com/lark-webhook

# Agent 回调鉴权密钥（向后兼容，推荐使用管理后台创建 DB 密钥）
# 生成：openssl rand -hex 32
# ⚠️  此 key 用于两个方向：
#    1. rabbit-lark-bot → OpenClaw（HMAC 签名转发请求）
#    2. OpenClaw → /api/agent/send（Bearer 回调鉴权）
# ⚠️  也可通过管理后台 /api-keys 页面创建 DB 密钥替代此环境变量
AGENT_API_KEY=your_agent_api_key

AGENT_TIMEOUT_MS=30000

# =============================================================================
# 服务配置
# =============================================================================

# 本服务的公网地址（用于生成 reply_via.api 回调地址）
# ⚠️  飞书 webhook 必须用 HTTPS 域名，不能用 http://IP:PORT
#    正确：https://your-domain.com
#    错误：http://18.x.x.x:3456
API_BASE_URL=https://your-domain.com

PORT=3456
NODE_ENV=production
LOG_LEVEL=info

# 内置催办机器人功能（设 false 则纯做消息转发）
ENABLE_BUILTIN_BOT=true

# 催办定时任务扫描间隔（分钟，默认 15）
# REMINDER_CHECK_INTERVAL_MINUTES=15
ANTHROPIC_API_KEY=sk-ant-api03-your-key-here

# =============================================================================
# 已废弃（向后兼容保留）
# =============================================================================
# NEXT_PUBLIC_ADMIN_PASSWORD — 已迁移至服务端 ADMIN_PASSWORD
# NEXT_PUBLIC_API_KEY — 已被 JWT session cookie 替代
