# Edit History - 2026-02-25

## Summary

Major refactoring session that transformed rabbit-lark-bot from a simple script collection into a production-ready monorepo with full testing, CI/CD, and security infrastructure.

## Changes by Category

### Architecture Refactoring

- Restructured to monorepo: `packages/server`, `packages/web`, `packages/scripts`
- Added Docker Compose for deployment (postgres + server + web)
- PostgreSQL database for admin whitelist, settings, and audit logs

### New Features

- **Web Dashboard** (Next.js)
  - Dashboard with stats overview
  - Task management UI (create, complete, delete)
  - Admin management UI
  - Settings management UI

- **API Server** (Express)
  - RESTful API endpoints for all operations
  - Feishu webhook handler for bot interactions
  - User session management with TTL expiration

### Security Improvements

- Feishu webhook signature verification middleware
- API authentication middleware (API Key / Bearer Token)
- Rate limiting (API: 100/min, Webhook: 200/min)
- Environment variable validation on startup
- Database connection pool configuration

### Testing & CI/CD

- Jest unit tests for server API routes
- Jest + Testing Library for web components
- GitHub Actions CI workflow (test, lint, build)
- GitHub Actions Deploy workflow (manual trigger)
- ESLint configuration

### Code Quality (4 rounds of code review)

- Added proper error handling and timeouts to Feishu client
- Fixed session memory leak with TTL-based expiration
- Eliminated all `any` types in TypeScript
- Replaced console.log with structured logger
- Added comprehensive TypeScript types
- Used Next.js Link for client-side navigation

### Documentation

- CONTRIBUTING.md with development workflow
- CHANGELOG.md for version tracking
- docs/api.md with complete API documentation
- PR template with checklist

## Files Modified/Created

### New Files
- `docker-compose.yml`
- `db/init.sql`
- `CONTRIBUTING.md`
- `CHANGELOG.md`
- `.github/workflows/ci.yml`
- `.github/workflows/deploy.yml`
- `.github/pull_request_template.md`
- `docs/api.md`
- `packages/server/*` (entire server package)
- `packages/web/*` (entire web package)

### Modified Files
- `README.md` - Complete rewrite for monorepo
- `.env.example` - Added security and DB pool configs
- `.gitignore` - Added coverage, build, IDE files
